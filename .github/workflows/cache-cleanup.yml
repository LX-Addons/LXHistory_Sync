name: ğŸ§¹ ç¼“å­˜æ¸…ç†

on:
  pull_request:
    types:
      - closed
  workflow_dispatch:

permissions:
  actions: write
  contents: read

jobs:
  cleanup:
    name: æ¸…ç†ç¼“å­˜
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ—‘ï¸ æ¸…ç† PR ç¼“å­˜
        run: |
          echo "ğŸ“‹ æ­£åœ¨è·å–ç¼“å­˜åˆ—è¡¨..."
          cacheKeysForPR=$(gh cache list --ref $BRANCH --limit 100 --json id --jq '.[].id')
          
          echo "ğŸ—‘ï¸ æ­£åœ¨åˆ é™¤ç¼“å­˜..."
          for cacheKey in $cacheKeysForPR
          do
              gh cache delete $cacheKey
              echo "âœ… å·²åˆ é™¤ç¼“å­˜: $cacheKey"
          done
          
          echo "ğŸ‰ ç¼“å­˜æ¸…ç†å®Œæˆï¼"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
          BRANCH: refs/pull/${{ github.event.pull_request.number }}/merge
