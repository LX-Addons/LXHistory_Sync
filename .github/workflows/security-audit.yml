name: ðŸ”’ å®‰å…¨å®¡è®¡

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  schedule:
    - cron: '0 2 * * 1'
  workflow_dispatch:

permissions:
  contents: read
  security-events: write

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  security-audit:
    name: å®‰å…¨å®¡è®¡
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: ðŸ“¦ è®¾ç½® Node.js çŽ¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: 'package-lock.json'
      
      - name: ðŸ“¥ å®‰è£…é¡¹ç›®ä¾èµ–
        run: npm ci
      
      - name: ðŸ” æ£€æŸ¥ä¾èµ–æ¼æ´ž
        run: npm audit --audit-level=moderate
        continue-on-error: true
      
      - name: ðŸ” åˆå§‹åŒ– CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: javascript-typescript
      
      - name: ðŸ” æ‰§è¡Œ CodeQL åˆ†æž
        uses: github/codeql-action/analyze@v3
        continue-on-error: true
      
      - name: ðŸ“Š ç”Ÿæˆå®‰å…¨å®¡è®¡æŠ¥å‘Š
        if: always()
        run: |
          echo "## ðŸ”’ å®‰å…¨å®¡è®¡æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "å®¡è®¡æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### æ£€æŸ¥é¡¹ç›®" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ä¾èµ–æ¼æ´žæ‰«æ" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ä»£ç å®‰å…¨æ‰«æ" >> $GITHUB_STEP_SUMMARY
